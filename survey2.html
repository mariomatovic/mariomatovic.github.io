<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Strengths Insights</title>
<link rel="stylesheet" href="style.css"/>
<style>
  /* --- Styles for Textarea Labels --- */
  letters {
    font-weight: 600;
    margin-bottom: 8px;
    display: block; /* Ensures proper spacing */
    line-height: 1.5;
  }
  textarea {
    width: 100%;
    min-height: 80px;
    margin-bottom: 16px; /* Space after textareas */
  }
  #submitMsg2 {
    margin-top: 10px;
    color: red;
  }
  #nameFields input {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    margin-bottom: 12px;
    box-sizing: border-box;
  }
  
  /* --- Styles for the Spinner --- */
  .spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
    -webkit-animation: spin 1s ease-in-out infinite;
    vertical-align: middle;
    margin-right: 8px;
  }
  @keyframes spin { to { -webkit-transform: rotate(360deg); } }
  @-webkit-keyframes spin { to { -webkit-transform: rotate(360deg); } }

  /* --- Styles for the New Radio Button Question --- */
  fieldset {
    border: none;
    padding: 0;
    margin-bottom: 16px;
  }
  fieldset legend {
    font-weight: 600;
    margin-bottom: 8px;
    display: block;
    line-height: 1.5;
  }
  fieldset label {
    display: grid;
    grid-template-columns: min-content auto;
    gap: 10px;
    margin-bottom: 10px;
    align-items: start;
  }
  fieldset label input[type="radio"] {
    margin-top: 0.2em;
  }
</style>
</head>
<body>
<header>
  <div class="wrap">
  </div>
</header>

<main class="wrap">
  <section class="card">
    <h2>Strengths Insights</h2>

    <form id="survey2Form">
      <div id="nameFields" style="display:none;">
        <input type="text" id="name" name="name" placeholder="Name">
        <input type="text" id="surname" name="surname" placeholder="Surname">
      </div>

      <input type="hidden" name="Company" id="companyField">
      <input type="hidden" name="Role" id="roleField">
      <input type="hidden" name="Department" id="departmentField">

      <!-- NEW QUESTION 1 -->
      <letters>1. What is a natural talent of yours that your current work doesn't fully use?</letters>  
      <textarea name="Q1" required></textarea>  
  
      <!-- NEW QUESTION 2 (Multiple Choice) -->
      <fieldset>
        <legend>2. How does your mind solve problems? Choose one:</legend>
        <label><input type="radio" name="Q2" value="Logical Steps" required> Logical Steps - Step-by-step analysis.</label>
        <label><input type="radio" name="Q2" value="A Sudden Knowing"> A Sudden Knowing - The answer appears.</label>
        <label><input type="radio" name="Q2" value="A Felt Sense"> A Felt Sense - Guided by feeling.</label>
        <label><input type="radio" name="Q2" value="A Visual Blueprint"> A Visual Blueprint - You see it.</label>
      </fieldset>
  
      <!-- NEW QUESTION 3 -->
      <letters>3. Think back to your childhood. What did you instinctively try to 'take apart' to understand its hidden workings? Were you drawn to physical things like electronics and gadgets, or to non-physical things like social dynamics, people's motivations, and the 'rules' of human interaction?</letters>  
      <textarea name="Q3" required></textarea>  
  
      <!-- NEW QUESTION 4 -->
      <letters>4. In what category of problems do you feel a sudden 'click' of clarity? What kind of challenge makes you feel like you intuitively know the path to the solution?</letters>  
      <textarea name="Q4" required></textarea>

      <!-- NEW QUESTION 5 -->
      <letters>5. In any situation, what is the 'side-problem' your mind automatically starts working on for free? What puzzle does your brain instinctively analyze, long after the main task is over?</letters>  
      <textarea name="Q5" required></textarea>

      <!-- NEW QUESTION 6 -->
      <letters>6. Whose stories, ideas, or biographies do you seek out? Which thinkers or creators, living or dead, make you feel understood and validate a truth you've always known?</letters>  
      <textarea name="Q6" required></textarea>
  
      <button type="submit" id="submitBtn">Submit Survey</button>
      <div id="submitMsg2"></div>
    </form>
  </section>
</main>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzRKFwaLAwECH0mpGz5B0dsEoQkLq2fF3UlX1SO_jwT1fSx-tOIfbNeFQ3vRl-7HEbUtA/exec';

const urlParams = new URLSearchParams(window.location.search );
const company = urlParams.get('Company') || '';

if (!company) {
  window.location.href = 'survey1.html';
}

const role = urlParams.get('Role') || '';
const department = urlParams.get('Department') || '';
const requireName = urlParams.get('RequireName') === 'true';

document.getElementById('companyField').value = company;
document.getElementById('roleField').value = role;
document.getElementById('departmentField').value = department;

if (requireName) {
  const nameFieldsDiv = document.getElementById('nameFields');
  const nameInput = document.getElementById('name');
  const surnameInput = document.getElementById('surname');
  nameFieldsDiv.style.display = 'block';
  nameInput.required = true;
  surnameInput.required = true;
}

function setupForm(formId, sheetName) {
  const form = document.getElementById(formId);
  const submitMsg = document.getElementById('submitMsg2');
  const submitBtn = document.getElementById('submitBtn');
  const originalButtonHTML = submitBtn.innerHTML;

  form.addEventListener('submit', e => {
    e.preventDefault();

    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="spinner"></span>Processing...';
    submitMsg.textContent = '';

    const formData = new FormData(form);
    
    const name = formData.get('name') || '';
    const surname = formData.get('surname') || '';
    const fullName = name && surname ? `${name} ${surname}` : '';

    // --- UPDATED JAVASCRIPT OBJECT ---
    const obj = {
      Company: company,
      Role: role,
      Department: department,
      NameAndSurname: fullName,
      Q1: formData.get('Q1'),
      Q2: formData.get('Q2'),
      Q3: formData.get('Q3'),
      Q4: formData.get('Q4'),
      Q5: formData.get('Q5'),
      Q6: formData.get('Q6')
    };

    fetch(SCRIPT_URL,{
      method:'POST',
      body: JSON.stringify({action:'submitSurvey', sheet:sheetName, responses: obj})
    }).then(r=>r.json()).then(data=>{
      if(data.success){
        const cardSection = document.querySelector('.card');
        if (cardSection) {
          cardSection.innerHTML = '<div id="submitMsg2" style="color: green;">Survey submitted successfully! Loading final step...</div>';
        }
        
        const params = new URLSearchParams({
            Company: company,
            Department: department,
            Role: role
        });
        setTimeout(()=>{ window.location.replace('survey3.html?' + params.toString()); }, 1500);
      } else {
        submitMsg.textContent='Failed to submit. Please try again.';
        submitMsg.style.color = 'red';
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalButtonHTML;
      }
    }).catch(err=>{
      console.error(err);
      submitMsg.textContent='Network error. Please check your connection and try again.';
      submitMsg.style.color = 'red';
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalButtonHTML;
    });
  });
}

setupForm('survey2Form','Survey2Responses');
</script>

</body>
</html>
